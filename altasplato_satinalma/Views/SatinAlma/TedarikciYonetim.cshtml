@{
    ViewData["Title"] = "Tedarikçi Yönetimi";
}
@Html.Partial("_SASidebar")

<h2 class="text-center" style="color: #212d3d;">
    <i class="fas fa-users"></i> Tedarikçi Yönetimi
</h2>

<!-- Tedarikçi Listesi -->
<div class="mb-4" style="background-color: #ffffff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    <div class="d-flex justify-content-between align-items-center">
        <h4 style="color: #212d3d;">
            <i class="fas fa-list"></i> Tedarikçiler Listesi
        </h4>
        <div class="mb-4 text-end">
            <a asp-action="TedarikciEkle" class="btn btn-success" style="background-color: #27ae60; border: none; color: #ffffff;">
                <i class="fas fa-plus"></i> Tedarikçi Ekle
            </a>
        </div>
    </div>
    <table class="table table-striped table-hover" style="background-color: #ffffff; border-radius: 8px; overflow: hidden;">
        <thead style="background-color: #212d3d; color: #ffffff;">
            <tr>
                <th><i class="fas fa-user"></i> Tedarikçi Adı</th>
                <th><i class="fas fa-phone"></i> Telefon</th>
                <th><i class="fas fa-mail"></i> Mail</th>

                <th><i class="fas fa-map-marker-alt"></i> Adres</th>
                <th><i class="fas fa-map-marker-not"></i> Not</th>

                <th><i class="fas fa-map-marker-up"></i> Score</th>

                <th><i class="fas fa-tools"></i> İşlemler</th>
            </tr>
        </thead>
        <tbody style="color: #212d3d;">
            @foreach (var tedarikci in Model)
            {
                <tr style="background-color: #f8f9fa;" data-id="@tedarikci.Id">
                    <!-- Editable Row (Hidden) -->
                    <td class="edit-row" style="display: none;">
                        <input type="text" class="form-control" value="@tedarikci.TedarikciAdi" id="input-@tedarikci.Id-TedarikciAdi" />
                    </td>
                    <td class="edit-row" style="display: none;">
                        <input type="text" class="form-control" value="@tedarikci.TedarikciTelefon" id="input-@tedarikci.Id-TedarikciTelefon" />
                    </td>
                    <td class="edit-row" style="display: none;">
                        <input type="text" class="form-control" value="@tedarikci.TedarikciMail" id="input-@tedarikci.Id-TedarikciMail" />
                    </td>
                    <td class="edit-row" style="display: none;">
                        <input type="text" class="form-control" value="@tedarikci.TedarikciAdres" id="input-@tedarikci.Id-TedarikciAdres" />
                    </td>
                    <td class="edit-row" style="display: none;">
                        <input type="text" class="form-control" value="@tedarikci.TedarikciNot" id="input-@tedarikci.Id-TedarikciNot" />
                    </td>
                   

                    <!-- Regular Display Row -->
                    <td id="td-@tedarikci.Id-TedarikciAdi">@tedarikci.TedarikciAdi</td>
                    <td id="td-@tedarikci.Id-TedarikciTelefon">@tedarikci.TedarikciTelefon</td>
                    <td id="td-@tedarikci.Id-TedarikciMail">@tedarikci.TedarikciMail</td>

                    <td id="td-@tedarikci.Id-TedarikciAdres">@tedarikci.TedarikciAdres</td>
                    <td id="td-@tedarikci.Id-TedarikciNot">@tedarikci.TedarikciNot</td>

                    <td >@tedarikci.Score</td>

                    <td>
                        <button class="btn btn-warning btn-sm" id="edit-btn-@tedarikci.Id" style="color: #ffffff; background-color: #f39c12; border: none;" onclick="editRow(@tedarikci.Id)">
                            <i class="fas fa-edit"></i> Düzenle
                        </button>

                        <button class="btn btn-success btn-sm save-btn" id="save-btn-@tedarikci.Id" style= "display:none; background-color: #27ae60; color: #ffffff; border: none;" onclick="saveRow(@tedarikci.Id)">
                            <i class="fas fa-save"></i> Kaydet
                        </button>
                        <a href="@Url.Action("Degerlendir", new { id = tedarikci.Id })" class="btn btn-warning btn-sm" style="color: #ffffff; background-color: cornflowerblue; border: none;">
                            <i class="fas fa-edit"></i> Değerlendir
                        </a>


                        <!-- Delete Button -->
                        <a href="@Url.Action("TedarikciSil", new { id = tedarikci.Id })" class="btn btn-danger btn-sm" style="color: #ffffff; background-color: #e74c3c; border: none;">
                            <i class="fas fa-trash"></i> Sil
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    function editRow(id) {
        // Show the editable rows and hide regular display rows
        $('#td-' + id + '-TedarikciAdi').hide();
        $('#td-' + id + '-TedarikciTelefon').hide();
        $('#td-' + id + '-TedarikciAdres').hide();
        $('#td-' + id + '-TedarikciMail').hide();  // Hide the regular mail display
        $('#td-' + id + '-TedarikciNot').hide();

        // Show input fields for editing
        $('#input-' + id + '-TedarikciAdi').parent().show();
        $('#input-' + id + '-TedarikciTelefon').parent().show();
        $('#input-' + id + '-TedarikciAdres').parent().show();
        $('#input-' + id + '-TedarikciMail').parent().show();  // Show the editable mail input
        $('#input-' + id + '-TedarikciNot').parent().show();

        // Show the save button and hide the edit button
        $('#edit-btn-' + id).hide();
        $('#save-btn-' + id).show();
    }

    function saveRow(id) {
        // Get the updated values from the input fields
        var updatedName = $('#input-' + id + '-TedarikciAdi').val();
        var updatedPhone = $('#input-' + id + '-TedarikciTelefon').val();
        var updatedAddress = $('#input-' + id + '-TedarikciAdres').val();
        var updatedNot = $('#input-' + id + '-TedarikciNot').val();
        var updatedMail = $('#input-' + id + '-TedarikciMail').val();  // Get the updated mail

        // Hide the editable rows and show the regular display rows
        $('#input-' + id + '-TedarikciAdi').parent().hide();
        $('#input-' + id + '-TedarikciTelefon').parent().hide();
        $('#input-' + id + '-TedarikciAdres').parent().hide();
        $('#input-' + id + '-TedarikciMail').parent().hide();  // Hide the editable mail input
        $('#input-' + id + '-TedarikciNot').parent().hide();

        // Show the updated values in the regular display cells
        $('#td-' + id + '-TedarikciAdi').text(updatedName).show();
        $('#td-' + id + '-TedarikciTelefon').text(updatedPhone).show();
        $('#td-' + id + '-TedarikciAdres').text(updatedAddress).show();
        $('#td-' + id + '-TedarikciNot').text(updatedNot).show();
        $('#td-' + id + '-TedarikciMail').text(updatedMail).show();  // Show the updated mail

        // Show the edit button and hide the save button
        $('#edit-btn-' + id).show();
        $('#save-btn-' + id).hide();

        // Send the updated data to the server via AJAX
        $.ajax({
            url: '@Url.Action("UpdateTedarikci", "SatinAlma")',  // Make sure this URL is correct
            type: 'POST',
            data: {
                id: id,
                tedarikciAdi: updatedName,
                tedarikciTelefon: updatedPhone,
                tedarikciAdres: updatedAddress,
                tedarikciNot: updatedNot,
                tedarikciMail: updatedMail  // Send the updated mail
            },
            success: function (response) {
                Swal.fire({
                    title: 'Başarılı!',
                    text: 'Tedarikçi bilgileri başarıyla güncellendi!',
                    icon: 'success',
                    confirmButtonText: 'Tamam'
                });
            },
            error: function (xhr, status, error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Tedarikçi bilgileri güncellenirken bir hata oluştu!',
                    icon: 'error',
                    confirmButtonText: 'Tamam'
                });
            }
        });
    }
</script>

