@using static altasplato_satinalma.Controllers.SatinAlma

@{
    ViewData["Title"] = "Depo";
}
@Html.Partial("_SASidebar")
@model List<DepoTed>
    <h2 class="text-center" style="color: #212d3d;"><i class="fas fa-warehouse"></i> Depo Yönetimi</h2>

    <!-- Depo Ürün Listesi -->
<div class="mb-4" style="background-color: #ffffff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    <div class="d-flex justify-content-start align-items-center">
        <a asp-action="DepoYonetim" class="btn btn-outline-secondary" style="color: #212d3d; margin-right: 10px;"><i class="fas fa-boxes"></i> Depo Ürün Listesi</a>
        <a asp-action="DepoYonetimCikis" class="btn btn-outline-secondary" style="color: #212d3d; margin-right: 10px;"><i class="fas fa-boxes"></i> Depo Mal Çıkış</a>
        <a asp-action="DepoEk" class="btn btn-success" style="background-color: #27ae60; border: none; color: #ffffff;margin-right: 10px;">
            <i class="fas fa-plus"></i> Yeni Depo Ekle
        </a>
        @* <a asp-action="BekleyenStok" class="btn btn-success" style="background-color: #27ae60; border: none; color: #ffffff;margin-right: 10px;">
            <i class="fas fa-plus"></i> Bekleyen Stok Kartları
        </a> *@
    </div>
</div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success" role="alert">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }
        <table class="table table-striped table-hover" style="background-color: #ffffff; border-radius: 8px; overflow: hidden;">
            <thead style="background-color: #212d3d; color: #ffffff;">
                <tr>
@*                     <th><i class="fas fa-id-badge"></i> ID</th>
 *@                    <th><i class="fas fa-truck"></i> Tedarikçi Adı</th>
                    <th><i class="fas fa-box"></i> Ürün Adı</th>
                    <th><i class="fas fa-layer-group"></i> Kalan Adet</th>
                    <th><i class="fas fa-tags"></i> Kategori</th>
@*                     <th><i class="fas fa-money-bill-wave"></i> Birim Fiyat</th>
 *@                    <th><i class="fas fa-calendar-check"></i> Sipariş Onay Tarihi</th>
                    <th><i class="fas fa-calendar-alt"></i> Sipariş Termin Tarihi</th>
                    <th><i class="fas fa-calendar-day"></i> Ürün Geliş Tarihi</th>
                    <th><i class="fas fa-box-open"></i> Gelen Ürün Miktarı</th>
                    <th><i class="fas fa-user-check"></i> Kontrol Eden</th>
                    <th><i class="fas fa-clipboard-check"></i> Karar</th>
                    <th><i class="fas fa-tools"></i> İşlemler</th>
            <th>Açıklama</th>

                </tr>
            </thead>
            <tbody style="color: #212d3d;">
                @foreach (var urun in Model)
                {
                    <tr style="background-color: #f8f9fa;">
                        @* <td>@urun.Id</td> *@
                        <td>@urun.TedarikciAdi</td>
                        <td>@urun.Depo.UrunAdi</td>
                        <td>@urun.Depo.KalanAdet</td>
                        <td>@urun.Depo.Kategori</td>
@*                         <td>@urun.Depo.BirimFiyat</td>
 *@                        <td>@urun.Depo.SiparisOnayTarihi.ToString("yyyy-MM-dd")</td>
                        <td>@urun.Depo.SiparisTerminTarihi.ToString("yyyy-MM-dd")</td>
                        <td>@urun.Depo.UrunGelisTarihi.ToString("yyyy-MM-dd")</td>
                        <td>@urun.Depo.GelenUrunMiktari</td>
                        <td>@urun.Depo.KontrolEden</td>
                        <td>@urun.Depo.Karar</td>
                        <td>
                    <form id="urunEkleForm">
                        <button type="button"
                                onclick="ekleUrun(this)"
                                class="btn btn-primary btn-sm w-100 d-flex align-items-center justify-content-center"
                                data-urun-id="@urun.Depo.Id"
                                data-urun-adi="@urun.Depo.UrunAdi"
                                data-tedarikci-id="@urun.Depo.TedarikciId">
                            <i class="fas fa-sync"></i>
                        </button>
                    </form>


                    <form id="urunSilForm">
                        <button type="button"
                            onclick="urunSil(this)"
                                class="btn btn-danger btn-sm w-100 d-flex align-items-center justify-content-center"
                                data-urun-id="@urun.Depo.Id"
                                data-tedarikci-id="@urun.Depo.TedarikciId">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                   @*  <form method="post" asp-action="SilStok" asp-route-urunId="@urun.Depo.Id" asp-route-TedarikciId="@urun.Depo.TedarikciId">
                            <button type="submit" class="btn btn-danger btn-sm w-100 d-flex align-items-center justify-content-center">
                                <i class="fas fa-trash"></i> <!-- Trash icon for delete -->
                            </button>
                        </form> *@



                            

                        </td>
                <td>@urun.Depo.Aciklama</td>

                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>
<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function urunSil(button) {
        var urunId = button.getAttribute('data-urun-id');
        var tedarikciId = button.getAttribute('data-tedarikci-id'); // Tırnak hatası düzeltildi.

        $.ajax({
            url: '@Url.Action("SilStok", "SatinAlma")',
            type: 'POST',
            data: {
                urunId: urunId,
                tedarikciId: tedarikciId
            },
            success: function (response) { // 'succes' yerine 'success' yazıldı.
                Swal.fire({
                    title: 'Başarılı!',
                    text: 'Ürün başarıyla silindi.',
                    icon: 'success', // SweetAlert'teki geçerli ikon kullanıldı.
                    confirmButtonText: 'Tamam'
                });
            },
            error: function (xhr, status, error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Ürün silinirken bir hata oluştu!',
                    icon: 'error',
                    confirmButtonText: 'Tamam'
                });
            }
        });
    }
</script>
<script>
       function ekleUrun(button) {
        var urunId = button.getAttribute('data-urun-id');
        var urunAdi = button.getAttribute('data-urun-adi');
        var tedarikciId = button.getAttribute('data-tedarikci-id');

        $.ajax({
            url: '@Url.Action("EkleUrun", "SatinAlma")',
            type: 'POST',
            data: {
                urunId: urunId,
                urunAdi: urunAdi,
                tedarikciId: tedarikciId
            },
           success: function(response) {
            Swal.fire({
                title: 'Başarılı!',
                text: 'Ürün başarıyla eklendi.',
                icon: 'success',
                confirmButtonText: 'Tamam'
            });
        },
           error: function(xhr, status, error) {
            Swal.fire({
                title: 'Hata!',
                text: 'Ürün eklenirken bir hata oluştu!',
                icon: 'error',
                confirmButtonText: 'Tamam'
            });
        }
        });
    }

</script>